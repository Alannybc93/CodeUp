<!-- usuarios/templates/usuarios/perfil.html -->
{% extends 'base.html' %}
{% load static %}

{% block title %}Meu Perfil - CodeUP{% endblock %}

{% block extra_css %}
<style>
    /* ============================
       ESTILOS GERAIS
    ============================ */
    .profile-header {
        background: linear-gradient(135deg, rgba(255, 215, 0, 0.2), rgba(255, 215, 0, 0.05));
        color: #FFD700;
        padding: 40px;
        border-radius: 15px;
        text-align: center;
        margin-bottom: 30px;
        border: 2px solid rgba(255, 215, 0, 0.2);
        position: relative;
        overflow: hidden;
    }

    .profile-header::before {
        content: '';
        position: absolute;
        top: 0;
        left: 0;
        right: 0;
        height: 4px;
        background: linear-gradient(90deg, #FFD700, transparent);
    }

    .profile-header h1 {
        font-size: 2.5rem;
        margin-bottom: 10px;
        text-shadow: 0 2px 10px rgba(255, 215, 0, 0.3);
    }

    .profile-header p {
        font-size: 1.1rem;
        opacity: 0.9;
        max-width: 600px;
        margin: 0 auto;
    }

    /* ============================
       LAYOUT PRINCIPAL
    ============================ */
    .profile-main {
        display: grid;
        grid-template-columns: 1fr 2fr;
        gap: 30px;
        margin-bottom: 40px;
    }

    @media (max-width: 900px) {
        .profile-main {
            grid-template-columns: 1fr;
        }
    }

    /* ============================
       CARD DE PERFIL (ATUALIZADO PARA FOTO REAL)
    ============================ */
    .profile-card {
        background-color: #111111;
        border-radius: 15px;
        padding: 30px;
        border: 1px solid #222222;
        box-shadow: 0 10px 30px rgba(0, 0, 0, 0.2);
        height: fit-content;
        position: relative;
    }

    .profile-card::before {
        content: '';
        position: absolute;
        top: 0;
        left: 0;
        width: 100%;
        height: 4px;
        background: linear-gradient(90deg, #FFD700, transparent);
        border-radius: 15px 15px 0 0;
    }

    /* CONTAINER DA FOTO DO PERFIL (ATUALIZADO) */
    .profile-picture-container {
        position: relative;
        width: 200px;
        height: 200px;
        margin: 0 auto 25px;
        border-radius: 50%;
        overflow: hidden;
        border: 4px solid rgba(255, 215, 0, 0.2);
        box-shadow: 0 5px 15px rgba(0, 0, 0, 0.3);
        background-color: #222;
    }

    /* FOTO DO PERFIL REAL */
    .profile-picture {
        width: 100%;
        height: 100%;
        object-fit: cover;
        transition: transform 0.3s;
    }

    .profile-picture:hover {
        transform: scale(1.05);
    }

    /* √çCONE DA C√ÇMERA (aparece ao passar o mouse) */
    .camera-icon {
        position: absolute;
        bottom: 10px;
        right: 10px;
        background: rgba(0, 0, 0, 0.7);
        width: 40px;
        height: 40px;
        border-radius: 50%;
        display: flex;
        align-items: center;
        justify-content: center;
        opacity: 0;
        transition: opacity 0.3s, transform 0.3s;
        transform: translateY(10px);
    }

    .profile-picture-container:hover .camera-icon {
        opacity: 1;
        transform: translateY(0);
    }

    .camera-icon i {
        color: #FFD700;
        font-size: 1.2rem;
    }

    /* PLACEHOLDER SE N√ÉO HOUVER FOTO */
    .profile-picture-placeholder {
        width: 100%;
        height: 100%;
        background: linear-gradient(135deg, #FFD700 0%, #FFA500 100%);
        display: flex;
        align-items: center;
        justify-content: center;
        color: #1a1a1a;
        font-size: 60px;
        font-weight: bold;
    }

    .profile-info h2 {
        color: #FFD700;
        margin-bottom: 25px;
        padding-bottom: 10px;
        border-bottom: 1px solid rgba(255, 215, 0, 0.2);
        font-size: 1.8rem;
    }

    .info-item {
        margin-bottom: 15px;
        display: flex;
        align-items: center;
        padding: 10px 0;
        border-bottom: 1px solid rgba(255, 255, 255, 0.05);
    }

    .info-item:last-child {
        border-bottom: none;
    }

    .info-item i {
        margin-right: 15px;
        color: #FFD700;
        width: 20px;
        font-size: 1.2rem;
    }

    .info-label {
        font-weight: 600;
        color: #aaa;
        min-width: 120px;
    }

    .info-value {
        color: #fff;
        flex-grow: 1;
    }

    /* ============================
       A√á√ïES DO PERFIL
    ============================ */
    .profile-actions {
        display: flex;
        justify-content: center;
        gap: 15px;
        margin-top: 40px;
        padding-top: 30px;
        border-top: 1px solid rgba(255, 215, 0, 0.2);
        flex-wrap: wrap;
    }

    .btn-action {
        padding: 15px 25px;
        border-radius: 10px;
        border: none;
        font-weight: 600;
        font-size: 1rem;
        cursor: pointer;
        display: flex;
        align-items: center;
        gap: 10px;
        transition: all 0.3s;
        text-decoration: none;
        text-align: center;
        min-width: 160px;
        justify-content: center;
    }

    .btn-edit {
        background-color: rgba(255, 215, 0, 0.2);
        color: #FFD700;
        border: 1px solid rgba(255, 215, 0, 0.3);
    }

    .btn-edit:hover {
        background-color: rgba(255, 215, 0, 0.4);
        transform: translateY(-3px);
        box-shadow: 0 5px 15px rgba(255, 215, 0, 0.2);
    }

    .btn-primary {
        background: linear-gradient(135deg, #FFD700 0%, #FFA500 100%);
        color: #1a1a1a;
        border: none;
    }

    .btn-primary:hover {
        transform: translateY(-3px);
        box-shadow: 0 5px 15px rgba(255, 215, 0, 0.3);
    }

    .btn-settings {
        background-color: rgba(52, 152, 219, 0.2);
        color: #3498db;
        border: 1px solid rgba(52, 152, 219, 0.3);
    }

    .btn-settings:hover {
        background-color: rgba(52, 152, 219, 0.4);
        transform: translateY(-3px);
        box-shadow: 0 5px 15px rgba(52, 152, 219, 0.2);
    }

    .btn-danger {
        background-color: rgba(231, 76, 60, 0.2);
        color: #e74c3c;
        border: 1px solid rgba(231, 76, 60, 0.3);
    }

    .btn-danger:hover {
        background-color: rgba(231, 76, 60, 0.4);
        transform: translateY(-3px);
        box-shadow: 0 5px 15px rgba(231, 76, 60, 0.2);
    }

    .btn-home {
        background-color: rgba(255, 255, 255, 0.1);
        color: #fff;
        border: 1px solid rgba(255, 255, 255, 0.2);
    }

    .btn-home:hover {
        background-color: rgba(255, 255, 255, 0.15);
        transform: translateY(-3px);
        box-shadow: 0 5px 15px rgba(255, 255, 255, 0.1);
    }

    /* ============================
       ESTAT√çSTICAS
    ============================ */
    .stats-grid {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
        gap: 20px;
        margin-top: 20px;
    }

    .stat-card {
        background: rgba(255, 215, 0, 0.1);
        padding: 25px;
        border-radius: 10px;
        text-align: center;
        border: 1px solid rgba(255, 215, 0, 0.2);
        transition: all 0.3s;
    }

    .stat-card:hover {
        transform: translateY(-5px);
        box-shadow: 0 10px 20px rgba(255, 215, 0, 0.1);
    }

    .stat-value {
        font-size: 2.8rem;
        font-weight: bold;
        margin-bottom: 10px;
    }

    .stat-label {
        color: #aaa;
        font-size: 0.9rem;
        text-transform: uppercase;
        letter-spacing: 1px;
    }

    /* ============================
       MODAL DE EXCLUS√ÉO
    ============================ */
    .modal {
        display: none;
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background: rgba(0, 0, 0, 0.8);
        z-index: 1000;
        justify-content: center;
        align-items: center;
    }

    .modal-content {
        background: #1a1a1a;
        border-radius: 15px;
        padding: 40px;
        max-width: 500px;
        width: 90%;
        border: 2px solid #e74c3c;
        box-shadow: 0 0 30px rgba(231, 76, 60, 0.3);
    }

    /* ============================
       RESPONSIVIDADE
    ============================ */
    @media (max-width: 768px) {
        .profile-header h1 {
            font-size: 2rem;
        }
        
        .profile-picture-container {
            width: 150px;
            height: 150px;
        }
        
        .profile-actions {
            flex-direction: column;
            align-items: center;
        }
        
        .btn-action {
            width: 100%;
            max-width: 300px;
            justify-content: center;
        }
        
        .stats-grid {
            grid-template-columns: 1fr;
        }
    }
</style>
{% endblock %}

{% block content %}
<div class="container">
    <!-- HEADER DO PERFIL -->
    <header class="profile-header">
        <h1><i class="fas fa-user-circle"></i> Meu Perfil</h1>
        <p>Gerencie suas informa√ß√µes e acompanhe seu progresso</p>
    </header>

    <!-- MENSAGENS -->
    {% if messages %}
        <div style="margin-bottom: 30px;">
            {% for message in messages %}
                <div class="alert alert-{{ message.tags }}" style="
                    padding: 15px;
                    border-radius: 10px;
                    margin-bottom: 10px;
                    background: {% if message.tags == 'success' %}rgba(46, 204, 113, 0.1){% else %}rgba(231, 76, 60, 0.1){% endif %};
                    border: 1px solid {% if message.tags == 'success' %}rgba(46, 204, 113, 0.3){% else %}rgba(231, 76, 60, 0.3){% endif %};
                    color: {% if message.tags == 'success' %}#2ecc71{% else %}#e74c3c{% endif %};
                ">
                    <i class="fas fa-{% if message.tags == 'success' %}check-circle{% else %}exclamation-circle{% endif %}"></i>
                    {{ message }}
                </div>
            {% endfor %}
        </div>
    {% endif %}

    <!-- LAYOUT PRINCIPAL -->
    <main class="profile-main">
        <!-- COLUNA ESQUERDA - INFORMA√á√ïES B√ÅSICAS -->
        <div class="profile-card">
            <!-- FOTO DE PERFIL REAL (ATUALIZADA) -->
            <div class="profile-picture-container">
                {% if perfil.foto_perfil %}
                    <!-- Foto real do usu√°rio -->
                    <img src="{{ perfil.foto_perfil.url }}" 
                         alt="Foto de perfil de {{ user.username }}" 
                         class="profile-picture"
                         id="profilePicture"
                         onerror="this.style.display='none'; document.getElementById('profilePlaceholder').style.display='flex';">
                    
                    <!-- Placeholder que aparece se a foto falhar -->
                    <div id="profilePlaceholder" class="profile-picture-placeholder" style="display: none;">
                        {% if user.first_name or user.last_name %}
                            {{ user.first_name|first|upper }}{{ user.last_name|first|upper }}
                        {% else %}
                            {{ user.username|first|upper }}
                        {% endif %}
                    </div>
                {% else %}
                    <!-- Placeholder se n√£o houver foto -->
                    <div class="profile-picture-placeholder">
                        {% if user.first_name or user.last_name %}
                            {{ user.first_name|first|upper }}{{ user.last_name|first|upper }}
                        {% else %}
                            {{ user.username|first|upper }}
                        {% endif %}
                    </div>
                {% endif %}
                
                <!-- √çcone da c√¢mera (aparece ao passar o mouse) -->
                <div class="camera-icon" title="Alterar foto de perfil">
                    <i class="fas fa-camera"></i>
                </div>
            </div>

            <!-- INFORMA√á√ïES DO USU√ÅRIO -->
            <div class="profile-info">
                <h2><i class="fas fa-id-card"></i> Informa√ß√µes Pessoais</h2>
                
                <div class="info-item">
                    <i class="fas fa-user"></i>
                    <span class="info-label">Nome:</span>
                    <span class="info-value">
                        {% if user.get_full_name %}
                            {{ user.get_full_name }}
                        {% else %}
                            {{ user.username }}
                        {% endif %}
                    </span>
                </div>
                
                <div class="info-item">
                    <i class="fas fa-envelope"></i>
                    <span class="info-label">Email:</span>
                    <span class="info-value">{{ user.email|default:"N√£o informado" }}</span>
                </div>
                
                <div class="info-item">
                    <i class="fas fa-calendar-alt"></i>
                    <span class="info-label">Membro desde:</span>
                    <span class="info-value">{{ user.date_joined|date:"d/m/Y" }}</span>
                </div>
                
                <div class="info-item">
                    <i class="fas fa-user-check"></i>
                    <span class="info-label">Status:</span>
                    <span class="info-value">
                        {% if user.is_active %}
                            <span style="color: #2ecc71;">Ativo</span>
                        {% else %}
                            <span style="color: #e74c3c;">Inativo</span>
                        {% endif %}
                    </span>
                </div>

                <div class="info-item">
                    <i class="fas fa-sign-in-alt"></i>
                    <span class="info-label">√öltimo login:</span>
                    <span class="info-value">{{ user.last_login|date:"d/m/Y H:i"|default:"Nunca" }}</span>
                </div>
            </div>
        </div>

        <!-- COLUNA DIREITA - CONTE√öDO PRINCIPAL -->
        <div style="display: flex; flex-direction: column; gap: 30px;">
            <!-- SE√á√ÉO DE ESTAT√çSTICAS -->
            <div style="background-color: #111111; border-radius: 15px; padding: 30px; border: 1px solid #222222;">
                <h2 style="color: #FFD700; margin-bottom: 25px; padding-bottom: 10px; border-bottom: 1px solid rgba(255, 215, 0, 0.2);">
                    <i class="fas fa-chart-bar"></i> Minhas Estat√≠sticas
                </h2>
                
                <div class="stats-grid">
                    <div class="stat-card">
                        <div class="stat-value" style="color: #FFD700;">{{ perfil.exercicios_resolvidos|default:"0" }}</div>
                        <div class="stat-label">Exerc√≠cios Resolvidos</div>
                    </div>
                    
                    <div class="stat-card">
                        <div class="stat-value" style="color: #2ecc71;">{{ perfil.xp|default:"0" }}</div>
                        <div class="stat-label">Pontos de Experi√™ncia</div>
                    </div>
                    
                    <div class="stat-card">
                        <div class="stat-value" style="color: #3498db;">{{ perfil.trilhas_concluidas|default:"0" }}</div>
                        <div class="stat-label">Trilhas Conclu√≠das</div>
                    </div>
                    
                    <div class="stat-card">
                        <div class="stat-value" style="color: #9b59b6;">{{ perfil.nivel|default:"1" }}</div>
                        <div class="stat-label">N√≠vel</div>
                    </div>
                </div>
            </div>

            <!-- SE√á√ÉO DE ATIVIDADES -->
            <div style="background-color: #111111; border-radius: 15px; padding: 30px; border: 1px solid #222222;">
                <h2 style="color: #FFD700; margin-bottom: 25px; padding-bottom: 10px; border-bottom: 1px solid rgba(255, 215, 0, 0.2);">
                    <i class="fas fa-history"></i> Atividades Recentes
                </h2>
                
                <div style="color: #777; text-align: center; padding: 20px;">
                    <i class="fas fa-inbox" style="font-size: 3rem; margin-bottom: 15px; opacity: 0.3;"></i>
                    <p>Nenhuma atividade recente.</p>
                    <p style="font-size: 0.9rem; margin-top: 10px;">Comece a estudar para ver suas conquistas aqui!</p>
                </div>
            </div>
        </div>
    </main>

    <!-- A√á√ïES DO PERFIL -->
    <div class="profile-actions">
        <!-- BOT√ÉO PRINCIPAL - ESTUDAR -->
        <a href="/exercicios/" class="btn-action btn-primary">
            <i class="fas fa-play"></i> Continuar Estudando
        </a>
        
        <!-- BOT√ÉO EDITAR PERFIL -->
        <a href="/usuarios/perfil/editar/" class="btn-action btn-edit">
            <i class="fas fa-edit"></i> Editar Perfil
        </a>
        
        <!-- BOT√ÉO CONFIGURA√á√ïES -->
        <a href="/usuarios/perfil/configurar/" class="btn-action btn-settings">
            <i class="fas fa-cog"></i> Configura√ß√µes
        </a>
        
        <!-- BOT√ÉO ALTERAR SENHA -->
        <a href="/usuarios/perfil/alterar-senha/" class="btn-action btn-edit">
            <i class="fas fa-key"></i> Alterar Senha
        </a>
        
        <!-- BOT√ÉO EXCLUIR CONTA -->
        <button type="button" class="btn-action btn-danger" id="abrirModalExclusao">
            <i class="fas fa-trash-alt"></i> Excluir Conta
        </button>
        
        <!-- BOT√ÉO VOLTAR PARA HOME -->
        <a href="/" class="btn-action btn-home">
            <i class="fas fa-home"></i> Voltar para Home
        </a>
        
        <!-- BOT√ÉO VER TRILHAS -->
        <a href="/trilhas/" class="btn-action btn-edit">
            <i class="fas fa-road"></i> Ver Trilhas
        </a>
    </div>
</div>

<!-- MODAL DE CONFIRMA√á√ÉO DE EXCLUS√ÉO -->
<div id="modalExclusao" class="modal">
    <div class="modal-content">
        <div style="text-align: center; margin-bottom: 30px;">
            <div style="background: rgba(231, 76, 60, 0.2); width: 80px; height: 80px; border-radius: 50%; 
                        display: flex; align-items: center; justify-content: center; margin: 0 auto 20px;">
                <i class="fas fa-exclamation-triangle" style="font-size: 2.5rem; color: #e74c3c;"></i>
            </div>
            
            <h2 style="color: #e74c3c; margin-bottom: 15px;">Confirmar Exclus√£o da Conta</h2>
            <p style="color: #ccc; margin-bottom: 10px;">
                <strong>Esta a√ß√£o n√£o pode ser desfeita!</strong>
            </p>
            <p style="color: #999; margin-bottom: 20px;">
                Digite <code style="background: #222; padding: 2px 6px; border-radius: 4px; color: #ff9999;">EXCLUIR</code> 
                abaixo para confirmar que voc√™ deseja excluir permanentemente sua conta.
            </p>
        </div>
        
        <form method="POST" action="/usuarios/perfil/excluir/">
            {% csrf_token %}
            
            <div style="margin-bottom: 20px;">
                <label style="display: block; margin-bottom: 8px; color: #e74c3c; font-weight: 600;">
                    Digite "EXCLUIR" para confirmar:
                </label>
                <input type="text" 
                       id="confirmacaoExclusao" 
                       name="confirmacao"
                       style="width: 100%; padding: 12px; background: rgba(255,255,255,0.05); 
                              border: 1px solid #e74c3c; border-radius: 8px; 
                              color: white; font-size: 1rem; text-transform: uppercase;"
                       placeholder="EXCLUIR"
                       required>
            </div>
            
            <div style="margin-bottom: 25px;">
                <label style="display: block; margin-bottom: 8px; color: #e74c3c; font-weight: 600;">
                    <i class="fas fa-lock"></i> Digite sua senha atual:
                </label>
                <input type="password" 
                       name="senha_atual" 
                       style="width: 100%; padding: 12px; background: rgba(255,255,255,0.05); 
                              border: 1px solid #e74c3c; border-radius: 8px; 
                              color: white; font-size: 1rem;"
                       placeholder="Sua senha atual"
                       required>
            </div>
            
            <div style="display: flex; gap: 15px;">
                <button type="button" 
                        id="cancelarExclusao"
                        style="flex: 1; background: rgba(255, 255, 255, 0.1); color: white; padding: 14px;
                               border-radius: 10px; font-weight: 600; border: 1px solid #333; cursor: pointer;">
                    <i class="fas fa-times"></i> Cancelar
                </button>
                
                <button type="submit" 
                        id="confirmarExclusao"
                        style="flex: 1; background: linear-gradient(135deg, #e74c3c 0%, #c0392b 100%); 
                               color: white; padding: 14px; border-radius: 10px; 
                               font-weight: 700; border: none; cursor: pointer;"
                        disabled>
                    <i class="fas fa-trash-alt"></i> Excluir Conta Permanentemente
                </button>
            </div>
        </form>
    </div>
</div>
{% endblock %}

{% block extra_js %}
<script>
    document.addEventListener('DOMContentLoaded', function() {
        console.log("üë§ P√°gina de perfil carregada");
        
        // Verificar se a foto carregou corretamente
        const profilePicture = document.getElementById('profilePicture');
        if (profilePicture) {
            console.log("üì∏ Tentando carregar foto de perfil:", profilePicture.src);
            
            // Adicionar listener para erro na imagem
            profilePicture.onerror = function() {
                console.log("‚ùå Erro ao carregar imagem. Exibindo placeholder.");
                this.style.display = 'none';
                const placeholder = document.getElementById('profilePlaceholder');
                if (placeholder) {
                    placeholder.style.display = 'flex';
                    placeholder.style.animation = 'fadeIn 0.5s ease';
                }
            };
            
            // Adicionar listener para sucesso na imagem
            profilePicture.onload = function() {
                console.log("‚úÖ Foto carregada com sucesso!");
                
                // Adicionar efeito sutil quando a imagem carregar
                this.style.opacity = '0';
                setTimeout(() => {
                    this.style.transition = 'opacity 0.5s ease';
                    this.style.opacity = '1';
                }, 100);
            };
            
            // Tentar for√ßar o carregamento da imagem
            setTimeout(() => {
                if (profilePicture.complete && profilePicture.naturalHeight === 0) {
                    console.log("‚ö†Ô∏è Imagem parece n√£o ter carregado, for√ßando placeholder");
                    profilePicture.onerror();
                }
            }, 1000);
        }
        
        // Animar os cart√µes de estat√≠stica
        const statCards = document.querySelectorAll('.stat-card');
        statCards.forEach((card, index) => {
            card.style.opacity = '0';
            card.style.transform = 'translateY(20px)';
            
            setTimeout(() => {
                card.style.transition = 'opacity 0.5s ease, transform 0.5s ease';
                card.style.opacity = '1';
                card.style.transform = 'translateY(0)';
            }, index * 100);
        });
        
        // Efeito hover na foto de perfil
        if (profilePicture) {
            profilePicture.addEventListener('mouseenter', function() {
                this.style.transform = 'scale(1.05)';
            });
            
            profilePicture.addEventListener('mouseleave', function() {
                this.style.transform = 'scale(1)';
            });
        }
        
        // Animar bot√µes quando aparecem
        const buttons = document.querySelectorAll('.btn-action');
        buttons.forEach((button, index) => {
            button.style.opacity = '0';
            button.style.transform = 'translateY(10px)';
            
            setTimeout(() => {
                button.style.transition = 'opacity 0.3s ease, transform 0.3s ease';
                button.style.opacity = '1';
                button.style.transform = 'translateY(0)';
            }, 300 + (index * 50));
        });
        
        // ============================
        // FUNCIONALIDADE DE EXCLUS√ÉO
        // ============================
        const modal = document.getElementById('modalExclusao');
        const abrirBtn = document.getElementById('abrirModalExclusao');
        const cancelarBtn = document.getElementById('cancelarExclusao');
        const confirmarBtn = document.getElementById('confirmarExclusao');
        const inputConfirmacao = document.getElementById('confirmacaoExclusao');
        
        // Abrir modal
        abrirBtn.addEventListener('click', function() {
            modal.style.display = 'flex';
            modal.style.animation = 'fadeIn 0.3s ease';
            modal.querySelector('.modal-content').style.animation = 'slideIn 0.3s ease';
        });
        
        // Fechar modal
        cancelarBtn.addEventListener('click', function() {
            modal.style.display = 'none';
        });
        
        // Fechar modal ao clicar fora
        modal.addEventListener('click', function(e) {
            if (e.target === modal) {
                modal.style.display = 'none';
            }
        });
        
        // Validar entrada de confirma√ß√£o
        inputConfirmacao.addEventListener('input', function() {
            const valor = this.value.trim().toUpperCase();
            
            if (valor === 'EXCLUIR') {
                confirmarBtn.disabled = false;
                confirmarBtn.style.opacity = '1';
                confirmarBtn.style.cursor = 'pointer';
            } else {
                confirmarBtn.disabled = true;
                confirmarBtn.style.opacity = '0.5';
                confirmarBtn.style.cursor = 'not-allowed';
            }
        });
        
        // Prevenir envio acidental com Enter
        inputConfirmacao.addEventListener('keydown', function(e) {
            if (e.key === 'Enter') {
                e.preventDefault();
            }
        });
        
        // Confirma√ß√£o final antes de excluir
        const formExclusao = document.querySelector('form[action*="excluir"]');
        if (formExclusao) {
            formExclusao.addEventListener('submit', function(e) {
                const confirmacao = inputConfirmacao.value.trim().toUpperCase();
                const senha = document.querySelector('input[name="senha_atual"]').value;
                
                if (confirmacao !== 'EXCLUIR') {
                    e.preventDefault();
                    alert('Por favor, digite "EXCLUIR" para confirmar.');
                    inputConfirmacao.focus();
                    return false;
                }
                
                if (!senha) {
                    e.preventDefault();
                    alert('Por favor, digite sua senha atual.');
                    document.querySelector('input[name="senha_atual"]').focus();
                    return false;
                }
                
                // Confirma√ß√£o final
                const finalConfirm = confirm('üö® ATEN√á√ÉO FINAL üö®\n\nVoc√™ est√° prestes a excluir PERMANENTEMENTE sua conta. Esta a√ß√£o N√ÉO pode ser desfeita.\n\n‚Ä¢ Todos os seus dados ser√£o perdidos\n‚Ä¢ Seu progresso ser√° apagado\n‚Ä¢ N√£o ser√° poss√≠vel recuperar\n\nTem certeza absoluta?');
                
                if (!finalConfirm) {
                    e.preventDefault();
                    return false;
                }
                
                // Mostrar loading
                confirmarBtn.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Excluindo...';
                confirmarBtn.disabled = true;
            });
        }
        
        // Testar URLs (para debug)
        console.log('URLs configuradas:');
        console.log('- Editar Perfil: /usuarios/perfil/editar/');
        console.log('- Configura√ß√µes: /usuarios/perfil/configurar/');
        console.log('- Alterar Senha: /usuarios/perfil/alterar-senha/');
        console.log('- Excluir Conta: /usuarios/perfil/excluir/');
        
        // Log de informa√ß√µes do perfil
        console.log('üìä Informa√ß√µes do perfil:');
        console.log('- XP:', {{ perfil.xp|default:0 }});
        console.log('- Exerc√≠cios resolvidos:', {{ perfil.exercicios_resolvidos|default:0 }});
        console.log('- Trilhas conclu√≠das:', {{ perfil.trilhas_concluidas|default:0 }});
        console.log('- N√≠vel:', {{ perfil.nivel|default:1 }});
    });
</script>
{% endblock %}